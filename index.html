<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Tarefas - Isabela e Yasmin</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const Trash2 = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
        );
        
        const Download = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );
        
        const DollarSign = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="1" x2="12" y2="23"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
        );
        
        const RefreshCw = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="23 4 23 10 17 10"></polyline>
                <polyline points="1 20 1 14 7 14"></polyline>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
            </svg>
        );

        const AlertTriangle = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
        );

        const ControleTarefas = () => {
            const VALOR_POR_TAREFA = 0.56;
            const STORAGE_KEY = 'tarefas-filhas-local-dados';
            const SENHA_ADMIN = 'RLP72834609lpro!/';
            
            const [registros, setRegistros] = useState([]);
            const [carregando, setCarregando] = useState(true);
            const [salvando, setSalvando] = useState(false);
            const [formulario, setFormulario] = useState({
                filha: 'Isabela',
                data: new Date().toISOString().split('T')[0],
                arrumarQuarto: 'nao',
                retirarPo: 'nao',
                lavarLouca: 'nao'
            });
            const [filtro, setFiltro] = useState({
                dataInicio: '',
                dataFim: '',
                ativo: false
            });

            const carregarDados = () => {
                try {
                    const dados = localStorage.getItem(STORAGE_KEY);
                    if (dados) {
                        setRegistros(JSON.parse(dados));
                    }
                } catch (error) {
                    console.log('Erro ao carregar dados');
                } finally {
                    setCarregando(false);
                }
            };

            useEffect(() => {
                carregarDados();
            }, []);

            const salvarRegistros = (novosRegistros) => {
                try {
                    setSalvando(true);
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(novosRegistros));
                    setRegistros(novosRegistros);
                    setTimeout(() => setSalvando(false), 500);
                } catch (error) {
                    alert('Erro ao salvar. Tente novamente.');
                    setSalvando(false);
                }
            };

            const handleGravar = () => {
                const tarefasRealizadas = [
                    formulario.arrumarQuarto === 'sim',
                    formulario.retirarPo === 'sim',
                    formulario.lavarLouca === 'sim'
                ].filter(Boolean).length;

                const valorDia = tarefasRealizadas * VALOR_POR_TAREFA;

                const novoRegistro = {
                    id: Date.now(),
                    filha: formulario.filha,
                    data: formulario.data,
                    arrumarQuarto: formulario.arrumarQuarto === 'sim',
                    retirarPo: formulario.retirarPo === 'sim',
                    lavarLouca: formulario.lavarLouca === 'sim',
                    valor: valorDia,
                    pago: false
                };

                salvarRegistros([...registros, novoRegistro]);

                setFormulario({
                    filha: 'Isabela',
                    data: new Date().toISOString().split('T')[0],
                    arrumarQuarto: 'nao',
                    retirarPo: 'nao',
                    lavarLouca: 'nao'
                });
            };

            const handleExcluir = (id) => {
                if (window.confirm('Deseja realmente excluir este registro?')) {
                    salvarRegistros(registros.filter(r => r.id !== id));
                }
            };

            const handleMarcarPago = (id) => {
                salvarRegistros(registros.map(r => 
                    r.id === id ? { ...r, pago: !r.pago } : r
                ));
            };

            const handleLimparHistorico = () => {
                const senha = window.prompt('⚠️ ATENÇÃO: Esta ação irá apagar TODO o histórico!\n\nDigite a senha de administrador:');
                
                if (senha === null) {
                    return;
                }
                
                if (senha === SENHA_ADMIN) {
                    const confirmacao = window.confirm('⚠️ ÚLTIMA CONFIRMAÇÃO:\n\nTem certeza que deseja apagar TODOS os registros?\n\nEsta ação não pode ser desfeita!');
                    
                    if (confirmacao) {
                        salvarRegistros([]);
                        alert('✅ Histórico limpo com sucesso!');
                    }
                } else {
                    alert('❌ Senha incorreta! O histórico não foi apagado.');
                }
            };

            const filtrarRegistros = (regs) => {
                if (!filtro.ativo || (!filtro.dataInicio && !filtro.dataFim)) {
                    return regs;
                }
                
                return regs.filter(r => {
                    const dataRegistro = r.data;
                    if (filtro.dataInicio && dataRegistro < filtro.dataInicio) return false;
                    if (filtro.dataFim && dataRegistro > filtro.dataFim) return false;
                    return true;
                });
            };

            const calcularTotal = (filha, apenasPendentes = false) => {
                const regsParaCalcular = filtrarRegistros(registros);
                return regsParaCalcular
                    .filter(r => r.filha === filha)
                    .filter(r => !apenasPendentes || !r.pago)
                    .reduce((acc, r) => acc + r.valor, 0);
            };

            const aplicarFiltro = () => {
                if (!filtro.dataInicio && !filtro.dataFim) {
                    alert('⚠️ Selecione pelo menos uma data (início ou fim)');
                    return;
                }
                setFiltro({...filtro, ativo: true});
            };

            const limparFiltro = () => {
                setFiltro({
                    dataInicio: '',
                    dataFim: '',
                    ativo: false
                });
            };

            const exportarExcel = () => {
                const registrosParaExportar = filtrarRegistros(registros);
                const periodoTexto = filtro.ativo 
                    ? `_${filtro.dataInicio || 'inicio'}_a_${filtro.dataFim || 'fim'}`
                    : '';
                
                const csv = [
                    ['Data', 'Filha', 'Arrumar Quarto', 'Retirar Pó', 'Lavar Louça', 'Valor (R$)', 'Status'],
                    ...registrosParaExportar.map(r => [
                        r.data,
                        r.filha,
                        r.arrumarQuarto ? 'Sim' : 'Não',
                        r.retirarPo ? 'Sim' : 'Não',
                        r.lavarLouca ? 'Sim' : 'Não',
                        r.valor.toFixed(2),
                        r.pago ? 'Pago' : 'Pendente'
                    ])
                ].map(row => row.join(',')).join('\n');

                const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `tarefas_filhas${periodoTexto}_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
            };

            if (carregando) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-pink-50 to-purple-50 flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin mb-4 mx-auto"><RefreshCw /></div>
                            <p className="text-gray-600">Carregando dados...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-pink-50 to-purple-50 p-2 sm:p-6">
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
                            <h1 className="text-2xl sm:text-3xl font-bold text-purple-800 mb-2 flex items-center gap-2">
                                <DollarSign />
                                Controle de Tarefas - Isabela e Yasmin
                            </h1>
                            <p className="text-sm sm:text-base text-gray-600">
                                R$ 0,56 por tarefa | R$ 50,00 por mês (30 dias)
                            </p>
                        </div>

                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4 sm:mb-6">
                            <div className="bg-gradient-to-br from-pink-500 to-pink-600 rounded-lg shadow-lg p-4 sm:p-6 text-white">
                                <h3 className="text-lg sm:text-xl font-semibold mb-2">💖 Isabela</h3>
                                <p className="text-2xl sm:text-3xl font-bold">
                                    R$ {calcularTotal('Isabela', true).toFixed(2)}
                                </p>
                                <p className="text-xs sm:text-sm opacity-90">A receber</p>
                                <p className="text-xs sm:text-sm opacity-75 mt-2">
                                    Total geral: R$ {calcularTotal('Isabela').toFixed(2)}
                                </p>
                            </div>

                            <div className="bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg shadow-lg p-4 sm:p-6 text-white">
                                <h3 className="text-lg sm:text-xl font-semibold mb-2">💜 Yasmin</h3>
                                <p className="text-2xl sm:text-3xl font-bold">
                                    R$ {calcularTotal('Yasmin', true).toFixed(2)}
                                </p>
                                <p className="text-xs sm:text-sm opacity-90">A receber</p>
                                <p className="text-xs sm:text-sm opacity-75 mt-2">
                                    Total geral: R$ {calcularTotal('Yasmin').toFixed(2)}
                                </p>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
                            <h2 className="text-lg sm:text-xl font-bold text-gray-800 mb-4">
                                📅 Filtrar por Período
                            </h2>
                            
                            <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Data Início
                                    </label>
                                    <input
                                        type="date"
                                        value={filtro.dataInicio}
                                        onChange={(e) => setFiltro({...filtro, dataInicio: e.target.value})}
                                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-base"
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Data Fim
                                    </label>
                                    <input
                                        type="date"
                                        value={filtro.dataFim}
                                        onChange={(e) => setFiltro({...filtro, dataFim: e.target.value})}
                                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-base"
                                    />
                                </div>

                                <div className="flex items-end gap-2">
                                    <button
                                        onClick={aplicarFiltro}
                                        className="flex-1 bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700 transition-all shadow-lg"
                                    >
                                        Filtrar
                                    </button>
                                    {filtro.ativo && (
                                        <button
                                            onClick={limparFiltro}
                                            className="flex-1 bg-gray-500 text-white py-3 rounded-lg font-semibold hover:bg-gray-600 transition-all shadow-lg"
                                        >
                                            Limpar
                                        </button>
                                    )}
                                </div>
                            </div>

                            {filtro.ativo && (
                                <div className="mt-4 p-3 bg-purple-50 rounded-lg border-l-4 border-purple-500">
                                    <p className="text-sm text-purple-800 font-medium">
                                        🔍 Exibindo registros de {filtro.dataInicio || '(início)'} até {filtro.dataFim || '(fim)'}
                                    </p>
                                </div>
                            )}
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
                            <h2 className="text-lg sm:text-xl font-bold text-gray-800 mb-4">
                                ➕ Registrar Tarefas do Dia
                            </h2>
                            
                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Filha
                                    </label>
                                    <select
                                        value={formulario.filha}
                                        onChange={(e) => setFormulario({...formulario, filha: e.target.value})}
                                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-base"
                                    >
                                        <option value="Isabela">Isabela</option>
                                        <option value="Yasmin">Yasmin</option>
                                    </select>
                                </div>

                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Data
                                    </label>
                                    <input
                                        type="date"
                                        value={formulario.data}
                                        onChange={(e) => setFormulario({...formulario, data: e.target.value})}
                                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-base"
                                    />
                                </div>
                            </div>

                            <div className="space-y-3 mb-6">
                                <div className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <span className="font-medium text-gray-700 text-sm sm:text-base">
                                        🛏️ Arrumar o quarto
                                    </span>
                                    <select
                                        value={formulario.arrumarQuarto}
                                        onChange={(e) => setFormulario({...formulario, arrumarQuarto: e.target.value})}
                                        className="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 text-base"
                                    >
                                        <option value="nao">Não</option>
                                        <option value="sim">Sim</option>
                                    </select>
                                </div>

                                <div className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <span className="font-medium text-gray-700 text-sm sm:text-base">
                                        🧹 Retirar pó dos móveis
                                    </span>
                                    <select
                                        value={formulario.retirarPo}
                                        onChange={(e) => setFormulario({...formulario, retirarPo: e.target.value})}
                                        className="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 text-base"
                                    >
                                        <option value="nao">Não</option>
                                        <option value="sim">Sim</option>
                                    </select>
                                </div>

                                <div className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <span className="font-medium text-gray-700 text-sm sm:text-base">
                                        🍽️ Lavar louça
                                    </span>
                                    <select
                                        value={formulario.lavarLouca}
                                        onChange={(e) => setFormulario({...formulario, lavarLouca: e.target.value})}
                                        className="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 text-base"
                                    >
                                        <option value="nao">Não</option>
                                        <option value="sim">Sim</option>
                                    </select>
                                </div>
                            </div>

                            <button
                                onClick={handleGravar}
                                disabled={salvando}
                                className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3 sm:py-4 rounded-lg font-bold text-base sm:text-lg hover:from-purple-700 hover:to-pink-700 transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                {salvando ? '⏳ Gravando...' : '💾 GRAVAR'}
                            </button>
                        </div>

                        <div className="grid grid-cols-1 sm:grid-cols-3 gap-3 mb-4 sm:mb-6">
                            <button
                                onClick={carregarDados}
                                className="bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-all shadow-lg flex items-center justify-center gap-2"
                            >
                                <RefreshCw />
                                Atualizar
                            </button>
                            <button
                                onClick={exportarExcel}
                                className="bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition-all shadow-lg flex items-center justify-center gap-2"
                            >
                                <Download />
                                Exportar
                            </button>
                            <button
                                onClick={handleLimparHistorico}
                                className="bg-red-600 text-white py-3 rounded-lg font-semibold hover:bg-red-700 transition-all shadow-lg flex items-center justify-center gap-2"
                            >
                                <AlertTriangle />
                                Limpar Histórico
                            </button>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-4 sm:p-6">
                            <h2 className="text-lg sm:text-xl font-bold text-gray-800 mb-4">
                                📋 Histórico de Tarefas ({filtrarRegistros(registros).length}{filtro.ativo ? ` de ${registros.length} total` : ''})
                            </h2>
                            
                            {filtrarRegistros(registros).length === 0 ? (
                                <p className="text-center text-gray-500 py-8">
                                    {filtro.ativo 
                                        ? 'Nenhum registro encontrado neste período.' 
                                        : 'Nenhum registro ainda. Comece registrando as tarefas!'}
                                </p>
                            ) : (
                                <div className="overflow-x-auto">
                                    <table className="w-full text-sm">
                                        <thead>
                                            <tr className="border-b-2 border-gray-200">
                                                <th className="text-left p-2 sm:p-3">Data</th>
                                                <th className="text-left p-2 sm:p-3">Filha</th>
                                                <th className="text-center p-2 sm:p-3 hidden sm:table-cell">🛏️</th>
                                                <th className="text-center p-2 sm:p-3 hidden sm:table-cell">🧹</th>
                                                <th className="text-center p-2 sm:p-3 hidden sm:table-cell">🍽️</th>
                                                <th className="text-right p-2 sm:p-3">Valor</th>
                                                <th className="text-center p-2 sm:p-3">Status</th>
                                                <th className="text-center p-2 sm:p-3">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {filtrarRegistros(registros).slice().reverse().map(registro => (
                                                <tr key={registro.id} className="border-b border-gray-100 hover:bg-gray-50">
                                                    <td className="p-2 sm:p-3 text-xs sm:text-sm">
                                                        {new Date(registro.data + 'T00:00:00').toLocaleDateString('pt-BR')}
                                                    </td>
                                                    <td className="p-2 sm:p-3">
                                                        <span className={`font-semibold text-xs sm:text-sm ${
                                                            registro.filha === 'Isabela' ? 'text-pink-600' : 'text-purple-600'
                                                        }`}>
                                                            {registro.filha}
                                                        </span>
                                                    </td>
                                                    <td className="text-center p-2 sm:p-3 hidden sm:table-cell">
                                                        {registro.arrumarQuarto ? '✅' : '❌'}
                                                    </td>
                                                    <td className="text-center p-2 sm:p-3 hidden sm:table-cell">
                                                        {registro.retirarPo ? '✅' : '❌'}
                                                    </td>
                                                    <td className="text-center p-2 sm:p-3 hidden sm:table-cell">
                                                        {registro.lavarLouca ? '✅' : '❌'}
                                                    </td>
                                                    <td className="text-right p-2 sm:p-3 font-semibold text-green-600 text-xs sm:text-sm">
                                                        R$ {registro.valor.toFixed(2)}
                                                    </td>
                                                    <td className="text-center p-2 sm:p-3">
                                                        <button
                                                            onClick={() => handleMarcarPago(registro.id)}
                                                            className={`px-2 sm:px-3 py-1 rounded-full text-xs font-semibold ${
                                                                registro.pago
                                                                    ? 'bg-green-100 text-green-700'
                                                                    : 'bg-yellow-100 text-yellow-700'
                                                            }`}
                                                        >
                                                            {registro.pago ? 'Pago' : 'Pendente'}
                                                        </button>
                                                    </td>
                                                    <td className="text-center p-2 sm:p-3">
                                                        <button
                                                            onClick={() => handleExcluir(registro.id)}
                                                            className="text-red-600 hover:text-red-800 p-1 sm:p-2"
                                                        >
                                                            <Trash2 />
                                                        </button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<ControleTarefas />, document.getElementById('root'));
    </script>
</body>
</html>
